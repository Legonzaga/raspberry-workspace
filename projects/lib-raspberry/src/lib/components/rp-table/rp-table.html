@defer{
  <table>
    @if(tableDataSource().columns?.length) {
      <thead>
        @for(col of tableDataSource().columns; track col.key) {
          <th>
            <div [class]="tableDataSource().align!" [ngClass]="col.filter ? 'th-description' : ''">
              {{ col.text }}
            </div>

            @if(col.filter) {
              <form [formGroup]="filterForm!">
                <div>
                  @switch(col.filter.type) { @case('select') {
                    <select
                      rpSelect
                      title="Filter by"
                      [name]="col.key"
                      [formControlName]="col.key"
                      (change)="inputFiltering($event || '', col.key)">
                      @for(op of col.filter.options; track $index) {
                        <option [value]="op.value ?? ''">{{ op.key }}</option>
                      }
                    </select>
                  } @default {
                    <input
                      rpInput
                      placeholder="Filter by {{ col.text }}"
                      min="1980"
                      maxlength="2100"
                      [type]="col.filter.type"
                      (input)="inputFiltering($event || '', col.key)"
                      [formControlName]="col.key"
                    />
                  } }
                </div>
              </form>
            }
          </th>
        }
      </thead>
    }
    <tbody>
      @for(row of (!filteredRows.length ? this.tableDataSource().rows : filteredRows); track $index) {
        <tr>
          @for(column of tableDataSource().columns; track column.text) {
            <td>{{ row[column.key] }}</td>
          }
        </tr>
      }
    </tbody>
  </table>

  @if(tableDataSource().paginator) {
    <rp-paginator [paginator]="tableDataSource().paginator"/>
  }
}
